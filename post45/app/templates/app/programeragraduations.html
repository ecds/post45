<head>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.6.1/css/buttons.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">

<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.flash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.html5.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<style>
  .popover-content {
      width: 300px;
      height: 200px;
      overflow-y: auto;
      white-space:pre-wrap;
  }
</style>
</head>

<body>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="{% url 'about' %}">Post45 Data</a>
      </div>
      <!-- <ul class="nav navbar-nav">
        <li class="active"><a href="/about">About</a></li>
      </ul> -->
    </div>
  </nav>
<div class="container-fluid">
<h1>Iowa Writers' Workshop: Graduations</h1>
<p>Table of Iowa graduates between 1931 and Spring 2014 that includes graduate name, advisor name, year of matriculation, program, degree, thesis title, and literary genre.</p>
<p>To download the full dataset in a tab-delimited file, <a href="{% url 'programeragraduationsdownload' %}">click here.</a></p>

<table id="record-table" class="stripe hover compact row-border" data-server-side="true" data-ajax="programeragraduations/?format=datatables">
  <thead>
    <tr>
    <th data-data="record_id">record_id <a href="#" data-toggle="popover" title="Definition" data-content="Numeric unique id of the graduation record in this database"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="graduate_name">graduate_name <a href="#" data-toggle="popover" title="Definition" data-content="Full name of the graduating student"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="graduate_id">graduate_id <a href="#" data-toggle="popover" title="Definition" data-content="Foreign key referring to person_id of the graduating student in people.tsv"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="institution">institution <a href="#" data-toggle="popover" title="Definition" data-content="Name of degree-granting institution"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="advisor_name">advisor_name <a href="#" data-toggle="popover" title="Definition" data-content="Full name of the student's thesis advisor"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="advisor_id">advisor_id <a href="#" data-toggle="popover" title="Definition" data-content="Foreign key referring to person_id of the thesis advisor in people.tsv"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="year">year <a href="#" data-toggle="popover" title="Definition" data-content="Year of matriculation"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="program">program <a href="#" data-toggle="popover" title="Definition" data-content="Program (e.g. Writers' Workshop) or major when no specific program applies (e.g. English)"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="degree">degree <a href="#" data-toggle="popover" title="Definition" data-content="e.g. 'MFA'""><i class="bi bi-question-circle"></i></a></th>

    <th data-data="thesis_title">thesis_title <a href="#" data-toggle="popover" title="Definition" data-content="Title of thesis where applicable"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="genre">genre <a href="#" data-toggle="popover" title="Definition" data-content="Literary genre of the thesis, e.g. 'Poetry', 'Fiction', 'Literary Translation'""><i class="bi bi-question-circle"></i></a></th>
      </tr>
        </thead>
        <tfoot>
          <tr>
            <th>record_id</th>
            <th>graduate_name</th>
            <th>graduate_id</th>
              <th>institution</th>
              <th>advisor_name</th>
              <th>advisor_id</th>
              <th>year</th>
              <th>program</th>
              <th>degree</th>
              <th>thesis_title</th>
              <th>genre</th>
          </tr>
          </tfoot>
</table>
</div>
</body>
<script>

    $(document).ready(function() {
      // Setup - add a text input to each footer cell
       $('#record-table tfoot th').each( function () {
           var title = $(this).text();
           $(this).html( '<input type="text" placeholder="Search '+title+'" />' );
       } );

    // DataTable
    var table = $('#record-table').DataTable( {

      //dom: 'lBfrtip',
      ajax: '/programeragraduations/?format=datatables',
     //  buttons: [
     //      {
     //        extend: 'csv',
     //        text: 'Download full dataset',
     //        fieldSeparator: '\t',
     //        fieldBoundary: '',
     //        extension: '.tsv',
     //        action: function (e, dt, button, config)
     //                {
     //                    dt.one('preXhr', function (e, s, data)
     //                    {
     //                        data.length = -1;
     //                    }).one('draw', function (e, settings, json, xhr)
     //                    {
     //                        var excelButtonConfig = $.fn.DataTable.ext.buttons.excelHtml5;
     //                        var addOptions = { exportOptions: { 'columns': ':all'} };
     //
     //                        $.extend(true, excelButtonConfig, addOptions);
     //                        excelButtonConfig.action(e, dt, button, excelButtonConfig);
     //                    }).draw();
     //                }
     //      },
     //     {
     //         extend: 'csv',
     //         text: 'Download filtered dataset',
     //         fieldSeparator: '\t',
     //         fieldBoundary: '',
     //         extension: '.tsv',
     //         action: newExportAction,
     //         exportOptions: {
     //            modifier: {
     //              search: 'applied',
     //              order: 'applied'
     //            }
     //        }
     //     }
     // ],

    "iDisplayLength": 10,

    orderCellsTop: true,

    "columnDefs": [
            // {
            //     "targets": [1, 4, 5, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,  22, 23, 24, 25, 26],
            //     "visible": false,
            //     "searchable": false
            // },
        ]
  } );

  // Apply the search
    table.columns().every( function () {
        var that = this;

        $( 'input', this.footer() ).on( 'keyup change clear', function () {
            if ( that.search() !== this.value ) {
                that
                    .search( this.value )
                    .draw();
            }
        } );
    } );
} );


// https://stackoverflow.com/a/44635032/2402028
var oldExportAction = function (self, e, dt, button, config) {
    if (button[0].className.indexOf('buttons-csv') >= 0) {
        if ($.fn.dataTable.ext.buttons.csvHtml5.available(dt, config)) {
            $.fn.dataTable.ext.buttons.csvHtml5.action.call(self, e, dt, button, config);
        }
        else {
            $.fn.dataTable.ext.buttons.csvFlash.action.call(self, e, dt, button, config);
        }
    } else if (button[0].className.indexOf('buttons-print') >= 0) {
        $.fn.dataTable.ext.buttons.print.action(e, dt, button, config);
    }
};

var newExportAction = function (e, dt, button, config) {
    var self = this;
    var oldStart = dt.settings()[0]._iDisplayStart;

    dt.one('preXhr', function (e, s, data) {
        // Just this once, load all data from the server...
        data.start = 0;
        data.length = 1000000;

        dt.one('preDraw', function (e, settings) {
            // Call the original action function
            oldExportAction(self, e, dt, button, config);

            dt.one('preXhr', function (e, s, data) {
                // DataTables thinks the first item displayed is index 0, but we're not drawing that.
                // Set the property to what it was before exporting.
                settings._iDisplayStart = oldStart;
                data.start = oldStart;
            });

            // Reload the grid with the original page. Otherwise, API functions like table.cell(this) don't work properly.
            setTimeout(dt.ajax.reload, 0);

            // Prevent rendering of the full data to the DOM
            return false;
        });
    });

    // Requery the server with the new one-time export settings
    dt.ajax.reload();
};


  </script>
  <script>
$(document).ready(function(){
  $('[data-toggle="popover"]').popover();
});
</script>
