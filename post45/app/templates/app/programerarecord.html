<head>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.6.1/css/buttons.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">

<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.flash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.html5.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<style>
  .popover-content {
      width: 250px;
      height: 200px;
      overflow-y: auto;
      white-space:pre-wrap;
  }
  table.dataTable thead .sorting_asc {
  background: url("https://cdn.datatables.net/1.10.0/images/sort_asc.png") no-repeat center left;
}
table.dataTable thead .sorting_desc {
  background: url("https://cdn.datatables.net/1.10.0/images/sort_desc.png") no-repeat center left;
}
table.dataTable thead .sorting {
  background: url("https://cdn.datatables.net/1.10.0/images/sort_both.png") no-repeat center left;
}

     table.dataTable.compact thead th, table.dataTable.compact thead td {
    padding: 10px 18px;
}
</style>

</head>

<body>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="https://data.post45.org/">Post45 Data Collective</a>
        <a class="navbar-brand" href="/about">Datasets</a>
      </div>
      <!-- <ul class="nav navbar-nav">
        <li class="active"><a href="/about">About</a></li>
      </ul> -->
    </div>
  </nav>
<div class="container-fluid">
<h1>Iowa Writers' Workshop: Corpus</h1>
<p><strong>Authors:</strong> Nicholas Kelly, Nicole White, Loren Glass</p>
<p>A table with titles by notable Iowa Writers' Workshop authors that are held by HathiTrust.</p>
<p>To download the full dataset in a tab-delimited file, <a href="{% url 'programerarecordsdownload' %}">click here.</a></p>
<p>To read the dataset's curatorial statement, <a href="https://data.post45.org/iowa-writers-workshop-the-program-era-project-curatorial-statement/">click here.</a></p>
<table id="record-table" class="stripe hover row-border dataTable" data-server-side="true" data-ajax="programerarecords/?format=datatables">
  <thead>
    <tr>
    <th data-data="htid">HTID <a href="#" data-toggle="popover" title="Definition" data-content="HathiTrust volume ID."><i class="bi bi-question-circle"></i></a></th>

    <th data-data="person_id">person_id <a href="#" data-toggle="popover" title="Definition" data-content="ID from people.tsv, for linking"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="author1_normalized">author1-normalized <a href="#" data-toggle="popover" title="Definition" data-content="Main author name (normalized by PEP team). We have manually added this field to ensure consistency for the searching and counting of lead author names. In some cases, HTRC author listings featured birth and death dates or punctuation that made names inconsistent. We have also included the original author fields as listed by HTRC for reference. "><i class="bi bi-question-circle"></i></a></th>

    <th data-data="author1">author1 <a href="#" data-toggle="popover" title="Definition" data-content="Main author (as listed in HTRC record)"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="author2">author2 <a href="#" data-toggle="popover" title="Definition" data-content="Secondary author or attribution"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="author3">author3 <a href="#" data-toggle="popover" title="Definition" data-content="Tertiary author or attribution"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="author4">author4 <a href="#" data-toggle="popover" title="Definition" data-content="Quaternary author or attribution"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="title">title <a href="#" data-toggle="popover" title="Definition" data-content="Volume title"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="imprint">imprint <a href="#" data-toggle="popover" title="Definition" data-content="Publishing imprint"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="date">date <a href="#" data-toggle="popover" title="Definition" data-content="Publication date"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="place">place <a href="#" data-toggle="popover" title="Definition" data-content="Publication place, drawn from MARC metadata, abbreviated, see the MARC Code List for Countries to interpret abbreviations (https://www.loc.gov/marc/countries/)"><i class="bi bi-question-circle"></i></a></th>

    <!-- <th data-data="subjects">subjects <a href="#" data-toggle="popover" title="Definition" data-content="Library of Congress subject headings for work (where available)"><i class="bi bi-question-circle"></i></a></th>

    <th data-data="geographics">geographics <a href="#" data-toggle="popover" title="Definition" data-content="Library of Congress listings for regions discussed by work (where available) "><i class="bi bi-question-circle"></i></a></th> -->

    <th data-data="lccn">lccn <a href="#" data-toggle="popover" title="Definition" data-content="Library of Congress Control Number (where available) "><i class="bi bi-question-circle"></i></a></th>

    <th data-data="oclc">oclc <a href="#" data-toggle="popover" title="Definition" data-content="OCLC (WorldCat) Control Number (where available) "><i class="bi bi-question-circle"></i></a></th>

    <th data-data="isbn">isbn <a href="#" data-toggle="popover" title="Definition" data-content="ISBN-10, ISBN-13 numbers for volume (where available) "><i class="bi bi-question-circle"></i></a></th>

    </tr>
        </thead>
        <tfoot>
          <tr>
            <th>HTID</th>
            <th>person_id</th>
            <th>author1-normalized</th>
            <th>author1</th>
            <th>author2</th>
            <th>author3</th>
            <th>author4</th>
            <th>title</th>
              <th>imprint</th>
              <th>date</th>
              <th>place</th>
              <!-- <th>subjects</th>
              <th>geographics</th> -->
              <th>lccn</th>
              <th>oclc</th>
              <th>isbn</th>
          </tr>
          </tfoot>
</table>
</div>
</body>
<script>

    $(document).ready(function() {
      // Setup - add a text input to each footer cell
       $('#record-table tfoot th').each( function () {
           var title = $(this).text();
           $(this).html( '<input type="text" placeholder="Search '+title+'" />' );
       } );

    // DataTable
    var table = $('#record-table').DataTable( {

      //dom: 'lBfrtip',
      ajax: '/programerarecords/?format=datatables',
     //  buttons: [
     //      {
     //        extend: 'csv',
     //        text: 'Download full dataset',
     //        fieldSeparator: '\t',
     //        fieldBoundary: '',
     //        extension: '.tsv',
     //        action: function (e, dt, button, config)
     //                {
     //                    dt.one('preXhr', function (e, s, data)
     //                    {
     //                        data.length = -1;
     //                    }).one('draw', function (e, settings, json, xhr)
     //                    {
     //                        var excelButtonConfig = $.fn.DataTable.ext.buttons.excelHtml5;
     //                        var addOptions = { exportOptions: { 'columns': ':all'} };
     //
     //                        $.extend(true, excelButtonConfig, addOptions);
     //                        excelButtonConfig.action(e, dt, button, excelButtonConfig);
     //                    }).draw();
     //                }
     //      },
     //     {
     //         extend: 'csv',
     //         text: 'Download filtered dataset',
     //         fieldSeparator: '\t',
     //         fieldBoundary: '',
     //         extension: '.tsv',
     //         action: newExportAction,
     //         exportOptions: {
     //            modifier: {
     //              search: 'applied',
     //              order: 'applied'
     //            }
     //        }
     //     }
     // ],

    "iDisplayLength": 10,

    orderCellsTop: true,

    "columnDefs": [
            // {
            //     "targets": [1, 4, 5, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,  22, 23, 24, 25, 26],
            //     "visible": false,
            //     "searchable": false
            // },
        ]
  } );

  // Apply the search
    table.columns().every( function () {
        var that = this;

        $( 'input', this.footer() ).on( 'keyup change clear', function () {
            if ( that.search() !== this.value ) {
                that
                    .search( this.value )
                    .draw();
            }
        } );
    } );
} );


// https://stackoverflow.com/a/44635032/2402028
var oldExportAction = function (self, e, dt, button, config) {
    if (button[0].className.indexOf('buttons-csv') >= 0) {
        if ($.fn.dataTable.ext.buttons.csvHtml5.available(dt, config)) {
            $.fn.dataTable.ext.buttons.csvHtml5.action.call(self, e, dt, button, config);
        }
        else {
            $.fn.dataTable.ext.buttons.csvFlash.action.call(self, e, dt, button, config);
        }
    } else if (button[0].className.indexOf('buttons-print') >= 0) {
        $.fn.dataTable.ext.buttons.print.action(e, dt, button, config);
    }
};

var newExportAction = function (e, dt, button, config) {
    var self = this;
    var oldStart = dt.settings()[0]._iDisplayStart;

    dt.one('preXhr', function (e, s, data) {
        // Just this once, load all data from the server...
        data.start = 0;
        data.length = 1000000;

        dt.one('preDraw', function (e, settings) {
            // Call the original action function
            oldExportAction(self, e, dt, button, config);

            dt.one('preXhr', function (e, s, data) {
                // DataTables thinks the first item displayed is index 0, but we're not drawing that.
                // Set the property to what it was before exporting.
                settings._iDisplayStart = oldStart;
                data.start = oldStart;
            });

            // Reload the grid with the original page. Otherwise, API functions like table.cell(this) don't work properly.
            setTimeout(dt.ajax.reload, 0);

            // Prevent rendering of the full data to the DOM
            return false;
        });
    });

    // Requery the server with the new one-time export settings
    dt.ajax.reload();
};


  </script>
  <script>
$(document).ready(function(){
  $('[data-toggle="popover"]').popover();
});
</script>
