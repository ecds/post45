<head>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.6.1/css/buttons.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">

<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.flash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.html5.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<style>
  .popover-content {
      height: 200px;
      overflow-y: auto;
      white-space:pre-wrap;
  }

  table.dataTable thead .sorting_asc {
  background: url("http://cdn.datatables.net/1.10.0/images/sort_asc.png") no-repeat center left;
}
table.dataTable thead .sorting_desc {
  background: url("http://cdn.datatables.net/1.10.0/images/sort_desc.png") no-repeat center left;
}
table.dataTable thead .sorting {
  background: url("http://cdn.datatables.net/1.10.0/images/sort_both.png") no-repeat center left;
}

     table.dataTable.compact thead th, table.dataTable.compact thead td {
    padding: 10px 18px;
}
</style>


</head>


<body>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="{% url 'about' %}">Post45 Data</a>
      </div>
      <!-- <ul class="nav navbar-nav">
        <li class="active"><a href="/about">About</a></li>
      </ul> -->
    </div>
  </nav>
<div class="container-fluid">

<h1>HathiTrust Fiction</h1>
<p>A table with metadata for fiction held by HathiTrust from 1945 to the present. Also includes HathiIDs.</p>
<p>To download the full dataset in a tab-delimited file, <a href="{% url 'download' %}">click here.</a></p>

<table id="record-table" class="stripe hover compact row-border dataTable" data-server-side="true" data-ajax="records/?format=datatables">
  <thead>
    <tr>
    <th data-data="docid">docid <a href="#" data-toggle="popover" title="Definition" data-content="HathiTrust volume ID. This is an item-level identifier for volumes. IDs used for pairtree storage can come in two different forms; I have provided the 'clean' versions of the IDs that are legal as filenames."><i class="bi bi-question-circle"></i></a></th>

    <th data-data="oldauthor">oldauthor <a href="#" data-toggle="popover" title="Definition" data-content="This is the author name as recorded in HathiTrust."><i class="bi bi-question-circle"></i></a></th>

    <th data-data="author">author <a href="#" data-toggle="popover" title="Definition" data-content="A version of the author name that has undergone some cleaning and standardization. For instance, honorifics like 'Sir' and 'Mrs' have been moved to the end of the name, as have parenthetical expansions of initials."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="authordate">authordate <a href="#" data-toggle="popover" title="Definition" data-content="Birth and death dates, to the extent that they were available in Hathi."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="title">title <a href="#" data-toggle="popover" title="Definition" data-content="The full title, as listed in HathiTrust."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="parttitle">parttitle <a href="#" data-toggle="popover" title="Definition" data-content="The volume-specific title, where one has been inferred."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="shorttitle">shorttitle <a href="#" data-toggle="popover" title="Definition" data-content="The title, minus certain formatting characters and statements about authorship. Collected Works have been replaced by volume-specific titles where possible."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="inferreddate">inferreddate <a href="#" data-toggle="popover" title="Definition" data-content="The earliest date of publication attested in various MARC date fields. But note, this is a date of publication, not a date of first publication. Inference is made by the function infer_date in the module SonicScredriver.py."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="latestcomp">latestcomp <a href="#" data-toggle="popover" title="Definition" data-content="The latest possible date of composition given everything else we know. It will be earlier than inferreddate if we know either 1) the author's date of death or 2) a copyright / first publication date for the title. For this process of inference, see makemaster/clean_master.ipynb*."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="datetype">datetype <a href="#" data-toggle="popover" title="Definition" data-content="Date type as extracted from MARC controlfield 008."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="startdate">startdate <a href="#" data-toggle="popover" title="Definition" data-content="Start date as extracted from MARC controlfield 008."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="enddate">enddate <a href="#" data-toggle="popover" title="Definition" data-content="End date as extracted from MARC controlfield 008."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="imprint">imprint <a href="#" data-toggle="popover" title="Definition" data-content="Imprint text stored in MARC."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="imprintdate">imprintdate <a href="#" data-toggle="popover" title="Definition" data-content="Imprinted date as extracted from other text fields in MARC."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="contents">contents <a href="#" data-toggle="popover" title="Definition" data-content="Usually describe parts of the work; these could be individual short stories in a collection, or volumes of a multi-volume Collected Works. When possible, I have used this guidance to assign specific titles to volumes."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="genres">genres <a href="#" data-toggle="popover" title="Definition" data-content="Mostly Library of Congress genre/form headings. At an early stage of processing, this field also contained some information from the MARC record leader, but that information was so unreliable that we removed it for final release."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="subjects">subjects <a href="#" data-toggle="popover" title="Definition" data-content="Library of Congress headings that a cataloger assigned to the work. "><i class="bi bi-question-circle"></i></a></th>

      <th data-data="geographics">geographics <a href="#" data-toggle="popover" title="Definition" data-content="Library of Congress headings that a cataloger assigned to the work. Geographics indicate that the work is about a specific region."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="locnum">locnum <a href="#" data-toggle="popover" title="Definition" data-content="Library of Congress call number, when available."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="oclc">oclc <a href="#" data-toggle="popover" title="Definition" data-content="OCLC number, when available."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="place">place <a href="#" data-toggle="popover" title="Definition" data-content="Place of publication code, as documented in MARC controlfield 008, to interpret it see the MARC Code List for Countries."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="recordid">recordid <a href="#" data-toggle="popover" title="Definition" data-content="This is the HathiTrust record ID; in multivolume works, it may be the same for all volumes."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="enumcron">enumcron <a href="#" data-toggle="popover" title="Definition" data-content="A field that usually distinguishes multiple volumes of a single record. Sometimes it has other uses."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="volnum">volnum <a href="#" data-toggle="popover" title="Definition" data-content="The numeric part of enumcron, if it seems to be a volume number."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="instances">instances <a href="#" data-toggle="popover" title="Definition" data-content="The number of copies of this volume (of this printing) collapsed in deduplication."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="juvenileprob">juvenileprob <a href="#" data-toggle="popover" title="Definition" data-content="I also trained a model to identify juvenile fiction. Volumes with a high probability in this column are set aside in a distinct table."><i class="bi bi-question-circle"></i></a></th>

      <th data-data="nonficprob">nonficprob <a href="#" data-toggle="popover" title="Definition" data-content="The probability that this work was nonfiction. The fiction/nonfiction boundary is tricky, so it was useful to train a model specifically for that boundary, leaving aside poetry, drama, etc."><i class="bi bi-question-circle"></i></a></th>
      </tr>
        </thead>
        <tfoot>
          <tr>
            <th>docid</th>
            <th>oldauthor</th>
            <th>author</th>
              <th>authordate</th>
              <th>title</th>
              <th>parttitle</th>
              <th>shorttitle</th>
              <th>inferreddate</th>
              <th>latestcomp</th>
              <th>datetype</th>
              <th>startdate</th>
              <th>enddate</th>
              <th>imprint</th>
              <th>imprintdate</th>
              <th>contents</th>
              <th>genres</th>
              <th>subjects</th>
              <th>geographics</th>
              <th>locnum</th>
              <th>oclc</th>
              <th>place</th>
              <th>recordid</th>
              <th>enumcron</th>
              <th>volnum</th>
              <th>instances</th>
              <th>juvenileprob</th>
              <th>nonficprob</th>
          </tr>
          </tfoot>
</table>
</div>
</body>
<script>

    $(document).ready(function() {
      // Setup - add a text input to each footer cell
       $('#record-table tfoot th').each( function () {
           var title = $(this).text();
           $(this).html( '<input type="text" placeholder="Search '+title+'" />' );
       } );

    // DataTable
    var table = $('#record-table').DataTable( {

      //dom: 'lBfrtip',
      ajax: '/records/?format=datatables',
     //  buttons: [
     //      {
     //        extend: 'csv',
     //        text: 'Download full dataset',
     //        fieldSeparator: '\t',
     //        fieldBoundary: '',
     //        extension: '.tsv',
     //        action: function (e, dt, button, config)
     //                {
     //                    dt.one('preXhr', function (e, s, data)
     //                    {
     //                        data.length = -1;
     //                    }).one('draw', function (e, settings, json, xhr)
     //                    {
     //                        var excelButtonConfig = $.fn.DataTable.ext.buttons.excelHtml5;
     //                        var addOptions = { exportOptions: { 'columns': ':all'} };
     //
     //                        $.extend(true, excelButtonConfig, addOptions);
     //                        excelButtonConfig.action(e, dt, button, excelButtonConfig);
     //                    }).draw();
     //                }
     //      },
     //     {
     //         extend: 'csv',
     //         text: 'Download filtered dataset',
     //         fieldSeparator: '\t',
     //         fieldBoundary: '',
     //         extension: '.tsv',
     //         action: newExportAction,
     //         exportOptions: {
     //            modifier: {
     //              search: 'applied',
     //              order: 'applied'
     //            }
     //        }
     //     }
     // ],

    "iDisplayLength": 10,

    orderCellsTop: true,

    // "columnDefs": [
    //         {
    //             "targets": [1, 4, 5, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,  22, 23, 24, 25, 26],
    //             "visible": false,
    //             "searchable": false
    //         },
    //     ]
  } );

  // Apply the search
    table.columns().every( function () {
        var that = this;

        $( 'input', this.footer() ).on( 'keyup change clear', function () {
            if ( that.search() !== this.value ) {
                that
                    .search( this.value )
                    .draw();
            }
        } );
    } );
} );


// https://stackoverflow.com/a/44635032/2402028
var oldExportAction = function (self, e, dt, button, config) {
    if (button[0].className.indexOf('buttons-csv') >= 0) {
        if ($.fn.dataTable.ext.buttons.csvHtml5.available(dt, config)) {
            $.fn.dataTable.ext.buttons.csvHtml5.action.call(self, e, dt, button, config);
        }
        else {
            $.fn.dataTable.ext.buttons.csvFlash.action.call(self, e, dt, button, config);
        }
    } else if (button[0].className.indexOf('buttons-print') >= 0) {
        $.fn.dataTable.ext.buttons.print.action(e, dt, button, config);
    }
};

var newExportAction = function (e, dt, button, config) {
    var self = this;
    var oldStart = dt.settings()[0]._iDisplayStart;

    dt.one('preXhr', function (e, s, data) {
        // Just this once, load all data from the server...
        data.start = 0;
        data.length = 1000000;

        dt.one('preDraw', function (e, settings) {
            // Call the original action function
            oldExportAction(self, e, dt, button, config);

            dt.one('preXhr', function (e, s, data) {
                // DataTables thinks the first item displayed is index 0, but we're not drawing that.
                // Set the property to what it was before exporting.
                settings._iDisplayStart = oldStart;
                data.start = oldStart;
            });

            // Reload the grid with the original page. Otherwise, API functions like table.cell(this) don't work properly.
            setTimeout(dt.ajax.reload, 0);

            // Prevent rendering of the full data to the DOM
            return false;
        });
    });

    // Requery the server with the new one-time export settings
    dt.ajax.reload();
};


  </script>
  <script>
$(document).ready(function(){
  $('[data-toggle="popover"]').popover();
});
</script>
